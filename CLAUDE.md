# HomeSystem 开发守则

> 提示：需要了解需求、架构、集成、测试等背景时，可先查看 `docs/README.md` 文档索引；那里列出已登记的相关说明和上下游线索，能更快定位可能复用的代码或设计。


## claude code 从荣八耻 

以瞎猜接口为耻，以认真查询为荣

以模糊执行为耻，以寻求确认为荣

以臆想业务为耻，以人类确认为荣

以创造接口为耻，以复用现有为荣

以跳过验证为耻，以主动测试为荣

以破坏架构为耻，以遵循规范为荣

以假装理解为耻，以诚实无知为荣

以盲目修改为耻，以谨慎重构为荣


## 文档索引管理

本项目所有“知识类”资产（需求、设计、架构、集成、分析、测试、术语等）必须在 `docs/` 下以 Markdown 形式存在，并通过 `docs/README.md` 这一“文档总索引”进行统一登记、检索与演进跟踪。严禁在对话、Issue/PR 讨论中留下唯一信息来源而未落地索引。

### 1. 权威索引文件
`docs/README.md` 为唯一权威索引。

### 2. 索引表字段
| ID | 路径 | 类型 | 摘要 | 上游依赖 | 下游引用 | 模块 | Owner | 状态 | 创建 | 更新 | 替代 | 废弃原因 |
|----|------|------|------|----------|----------|------|-------|------|------|------|------|----------|

字段说明：
- ID：`DOC-<递增序号>`（修订不变，新增才递增）
- 类型：`integration|api|architecture|deployment|workflow|troubleshooting|analysis|testing|glossary|other`
- 上游依赖：本文件依赖的其它文档 ID 列表（逗号分隔）
- 下游引用：当前已知引用本文件的文档 ID（可由工具定期反向生成）
- 模块：相关代码主模块（如 `graph`, `workflow`, `integrations`, `utility`，多值用逗号）
- 状态：`draft|reviewing|approved|deprecated`
- 替代：若已被替换，填入新文档 ID
- 废弃原因：仅在 deprecated 时填写简要原因（不超过 40 字）

### 3. 文档文件命名（统一格式）
`<类型>-<主题>-v<YYYY-MM-DD>[(-r<修订号>)] .md`
示例：`integration-llm-config-v2025-09-14.md` → 修订：`integration-llm-config-v2025-09-14-r1.md`

### 4. 文档头部建议（YAML Front Matter）
```yaml
---
title: <标题>
id: DOC-xxx            # 与索引表一致；初稿可留空，由登记人补齐
type: <见上>
created: 2025-09-14
updated: 2025-09-14
owner: <维护人/团队>
modules: [graph, workflow]
upstream: [DOC-001, DOC-010]
status: draft
superseded_by: null
deprecated_reason: null
---
```

### 5. 新增 / 更新流程
1. 创建或修改文档（填写 Front Matter 必需字段：title/type/owner/created）。
2. 运行（或手工执行）索引更新：在 `docs/README.md` 表格末尾新增或更新该行。
3. 若为更新：刷新 `updated` 字段，必要时报审查（`draft → reviewing → approved`）。
4. 在相关代码 PR 描述中列出影响文档 ID/路径。
5. 合并后由自动化或人工校验：无“未索引”文档。

### 6. 废弃 / 替代流程
1. 将文档 `status` 改为 `deprecated`。
2. 在索引同一行填写 `废弃原因`、如存在替代文档同步填写 `替代` 字段。
3. 原文顶部添加醒目提示（Deprecated banner），保留原内容供追溯。

### 7. 引用规范（唯一形式）
引用任何文档只使用路径或路径 + 锚点：
`docs/<子路径>/<文件名>#<可选锚点>`
不得粘贴大段原文；若需指向具体片段，为原文添加二级/三级标题后引用锚点。

### 8. 任务与文档绑定
任一开发 / 分析 / 测试任务必须声明：
- 输入文档（Input Docs：ID 列表或“None + 原因”）
- 输出文档（Output Docs：预期生成/更新的 ID 或“新建 TBD”）


### 9. 常见违规（直接退回）
1. 设计只存在于聊天记录 / PR 评论
2. 代码中出现大量策略说明却无对应 design/analysis 文档
3. 引用“上一条消息”而非给出 `docs/...` 路径
4. 新建文档未登记索引
5. 单文件混写需求+设计+测试且无法拆分

### 10. 自检 Checklist（阶段切换前必过）
- [ ] 是否有对应需求/设计文档并完成索引登记？
- [ ] 输入/输出文档是否声明完整？
- [ ] 索引表是否无重复 ID / 无空占位？
- [ ] 是否存在被下游引用的 draft 文档（需加速评审）？
- [ ] 近 7 日高频引用文档是否同步更新 `updated`？

### 11. CLAUDE.md 中的引用方式
若需在本文件中引用具体文档，仅追加到“文档清单”区，不改历史行，格式：
`docs/<目录>/<文件>.md —— <≤14字摘要>`

（以下为文档引用清单，新增请顺序追加）

