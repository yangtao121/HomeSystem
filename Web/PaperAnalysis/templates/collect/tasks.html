{% extends "base.html" %}

{% block title %}‰ªªÂä°Êü•Áúã - PaperGather{% endblock %}

{% block content %}
<!-- È°∂ÈÉ®Ê∏êÂèòËÉåÊôØÂå∫Âüü -->
<div class="hero-section">
    <div class="container-fluid">
        <!-- È°µÈù¢Ê†áÈ¢òÂíåÂø´ÈÄüÊìç‰Ωú -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <div class="hero-title-wrapper">
                        <h1 class="hero-title animated-title">
                            <i class="bi bi-list-task me-3 hero-icon"></i>
                            <span class="title-gradient">‰ªªÂä°ÁÆ°ÁêÜ</span>
                            <span class="title-subtitle">Task Management</span>
                        </h1>
                        <p class="hero-subtitle animated-subtitle">üîÑ Áªü‰∏ÄÁÆ°ÁêÜÊÇ®ÁöÑËÆ∫ÊñáÊî∂ÈõÜ‰ªªÂä°ÔºåÂÆûÊó∂ÁõëÊéßÊâßË°åÁä∂ÊÄÅ ‚ö°</p>
                    </div>
                    <div class="hero-action-buttons">
                        <button class="btn modern-action-btn refresh-btn" onclick="refreshTaskList()">
                            <div class="btn-icon-wrapper">
                                <i class="bi bi-arrow-clockwise btn-icon"></i>
                            </div>
                            <div class="btn-content">
                                <span class="btn-title">Âà∑Êñ∞Êï∞ÊçÆ</span>
                                <span class="btn-subtitle">Refresh</span>
                            </div>
                        </button>
                        <a href="{{ url_for('collect.config') }}" class="btn modern-action-btn create-btn">
                            <div class="btn-icon-wrapper">
                                <i class="bi bi-plus-circle btn-icon"></i>
                            </div>
                            <div class="btn-content">
                                <span class="btn-title">Êñ∞Âª∫‰ªªÂä°</span>
                                <span class="btn-subtitle">Create Task</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid main-content">

<!-- ‰ªªÂä°ÁªüËÆ°Ê¶ÇËßà -->
<div class="row stats-section mb-5">
    <!-- ÂÆöÊó∂‰ªªÂä°ÁªüËÆ° -->
    <div class="col-xl-3 col-md-6 col-sm-12 mb-4">
        <div class="modern-stats-card scheduled-card" data-aos="fade-up" data-aos-delay="100">
            <div class="stats-card-header">
                <div class="stats-icon-container">
                    <i class="bi bi-clock-history stats-icon"></i>
                    <div class="icon-glow"></div>
                </div>
                <div class="stats-badge">Â∑≤ÈÖçÁΩÆ</div>
            </div>
            <div class="stats-card-body">
                <div class="stats-number" id="scheduledTasksCount">
                    {{ scheduled_count | default(0) }}
                </div>
                <div class="stats-label">ÂÆöÊó∂‰ªªÂä°</div>
                <div class="stats-description">Scheduled Tasks</div>
            </div>
            <div class="stats-card-footer">
                <div class="progress-ring">
                    <div class="progress-fill scheduled-progress"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏ÄÊ¨°ÊÄß‰ªªÂä°ÁªüËÆ° -->
    <div class="col-xl-3 col-md-6 col-sm-12 mb-4">
        <div class="modern-stats-card immediate-card" data-aos="fade-up" data-aos-delay="200">
            <div class="stats-card-header">
                <div class="stats-icon-container">
                    <i class="bi bi-lightning-charge stats-icon"></i>
                    <div class="icon-glow"></div>
                </div>
                <div class="stats-badge">ÊâßË°åÂÆåÊàê</div>
            </div>
            <div class="stats-card-body">
                <div class="stats-number" id="immediateTasksCount">
                    {{ immediate_count | default(0) }}
                </div>
                <div class="stats-label">‰∏ÄÊ¨°ÊÄß‰ªªÂä°</div>
                <div class="stats-description">Immediate Tasks</div>
            </div>
            <div class="stats-card-footer">
                <div class="progress-ring">
                    <div class="progress-fill immediate-progress"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ËøêË°å‰∏≠‰ªªÂä°ÁªüËÆ° -->
    <div class="col-xl-3 col-md-6 col-sm-12 mb-4">
        <div class="modern-stats-card running-card" data-aos="fade-up" data-aos-delay="300">
            <div class="stats-card-header">
                <div class="stats-icon-container">
                    <i class="bi bi-play-circle stats-icon spinning"></i>
                    <div class="icon-glow"></div>
                </div>
                <div class="stats-badge active-badge">
                    <span class="pulse-dot"></span>
                    ÂÆûÊó∂Êõ¥Êñ∞
                </div>
            </div>
            <div class="stats-card-body">
                <div class="stats-number" id="runningTasksCount">
                    {{ running_count | default(0) }}
                </div>
                <div class="stats-label">ËøêË°å‰∏≠‰ªªÂä°</div>
                <div class="stats-description">Running Tasks</div>
            </div>
            <div class="stats-card-footer">
                <div class="progress-ring">
                    <div class="progress-fill running-progress"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊÄª‰ªªÂä°Êï∞ÁªüËÆ° -->
    <div class="col-xl-3 col-md-6 col-sm-12 mb-4">
        <div class="modern-stats-card total-card" data-aos="fade-up" data-aos-delay="400">
            <div class="stats-card-header">
                <div class="stats-icon-container">
                    <i class="bi bi-collection stats-icon"></i>
                    <div class="icon-glow"></div>
                </div>
                <div class="stats-badge">Á¥ØËÆ°</div>
            </div>
            <div class="stats-card-body">
                <div class="stats-number" id="totalTasksCount">
                    {{ total_count | default(0) }}
                </div>
                <div class="stats-label">ÊÄª‰ªªÂä°Êï∞</div>
                <div class="stats-description">Total Tasks</div>
            </div>
            <div class="stats-card-footer">
                <div class="progress-ring">
                    <div class="progress-fill total-progress"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12 mb-4">
        <!-- Áé∞‰ª£Âåñ‰ªªÂä°ÂàóË°®Âç°Áâá -->
        <div class="modern-task-card" data-aos="fade-up" data-aos-delay="500">
            <div class="task-card-header">
                <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-3">
                    <div class="task-header-left">
                        <h5 class="task-card-title mb-0">
                            <i class="bi bi-list-ul me-2 task-icon"></i>
                            <span class="title-text">‰ªªÂä°ÂàóË°®</span>
                            <span class="title-badge">Task List</span>
                        </h5>
                    </div>
                    <!-- Áé∞‰ª£ÂåñÁ≠õÈÄâÂô® -->
                    <div class="modern-filters d-flex flex-wrap gap-3 align-items-center">
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="bi bi-funnel me-1"></i>Á±ªÂûãÁ≠õÈÄâ
                            </label>
                            <select class="modern-select" id="taskTypeFilter">
                                <option value="all">ÂÖ®ÈÉ®Á±ªÂûã</option>
                                <option value="scheduled">ÂÆöÊó∂‰ªªÂä°</option>
                                <option value="immediate">‰∏ÄÊ¨°ÊÄß‰ªªÂä°</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="bi bi-circle-fill me-1"></i>Áä∂ÊÄÅÁ≠õÈÄâ
                            </label>
                            <select class="modern-select" id="taskStatusFilter">
                                <option value="all">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                                <option value="running">ËøêË°å‰∏≠</option>
                                <option value="completed">Â∑≤ÂÆåÊàê</option>
                                <option value="failed">Â§±Ë¥•</option>
                                <option value="stopped">Â∑≤ÂÅúÊ≠¢</option>
                                <option value="paused">Â∑≤ÊöÇÂÅú</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="task-card-body">
                {% if tasks %}
                <!-- Áé∞‰ª£ÂåñÊâπÈáèÊìç‰ΩúÂ∑•ÂÖ∑Ê†è -->
                <div class="modern-batch-toolbar" data-aos="fade-up" data-aos-delay="600">
                    <div class="batch-toolbar-inner">
                        <div class="batch-left">
                            <div class="select-all-wrapper">
                                <div class="modern-checkbox">
                                    <input class="checkbox-input" type="checkbox" id="selectAll">
                                    <label class="checkbox-label" for="selectAll">
                                        <span class="checkbox-icon">
                                            <i class="bi bi-check"></i>
                                        </span>
                                        <span class="checkbox-text">ÂÖ®ÈÄâ‰ªªÂä°</span>
                                    </label>
                                </div>
                            </div>
                            <div class="batch-actions">
                                <button class="btn modern-btn danger-btn d-none" id="batchDeleteBtn">
                                    <div class="btn-icon-wrapper">
                                        <i class="bi bi-trash btn-icon"></i>
                                    </div>
                                    <span class="btn-text">ÊâπÈáèÂà†Èô§ (<span id="selectedCount">0</span>)</span>
                                </button>
                                <button class="btn modern-btn warning-btn d-none" id="batchStopBtn">
                                    <div class="btn-icon-wrapper">
                                        <i class="bi bi-stop-fill btn-icon"></i>
                                    </div>
                                    <span class="btn-text">ÊâπÈáèÂÅúÊ≠¢ (<span id="selectedStopCount">0</span>)</span>
                                </button>
                            </div>
                        </div>
                        <div class="batch-right">
                            <div class="task-count-badge">
                                <i class="bi bi-list-task me-2"></i>
                                ÂÖ± <span id="totalTasksDisplay" class="count-number">{{ tasks|length }}</span> ‰∏™‰ªªÂä°
                                <span id="filteredTasksDisplay" class="d-none filtered-text">ÔºàÂ∑≤Á≠õÈÄâÔºâ</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modern-table-container">
                    <table class="modern-table enhanced-task-table mb-0" id="tasksTable">
                        <thead>
                            <tr>
                                <th class="table-checkbox-col" width="50px">
                                    <div class="modern-checkbox">
                                        <input class="checkbox-input" type="checkbox" id="selectAllHeader">
                                        <label class="checkbox-label" for="selectAllHeader">
                                            <span class="checkbox-icon">
                                                <i class="bi bi-check"></i>
                                            </span>
                                        </label>
                                    </div>
                                </th>
                                <th class="table-header-main">‰ªªÂä°‰ø°ÊÅØ</th>
                                <th class="table-header-secondary" width="160px">Á±ªÂûã</th>
                                <th class="table-header-secondary" width="120px">Áä∂ÊÄÅ</th>
                                <th class="table-header-secondary" width="200px">ÊâßË°å‰ø°ÊÅØ</th>
                                <th class="table-header-secondary" width="180px">ÈÖçÁΩÆ</th>
                                <th class="table-header-actions" width="200px">Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody id="tasksTableBody">
                            {% for task in tasks %}
                            <tr class="modern-table-row task-row" 
                                data-task-id="{{ task.task_id }}" 
                                data-task-type="{{ task.task_type }}"
                                data-task-status="{{ task.status }}"
                                data-aos="fade-up" 
                                data-aos-delay="{{ loop.index * 50 }}">
                                <td class="table-checkbox-cell">
                                    <div class="modern-checkbox">
                                        <input class="checkbox-input row-checkbox" type="checkbox" 
                                               value="{{ task.task_id }}" id="checkbox-{{ task.task_id }}">
                                        <label class="checkbox-label" for="checkbox-{{ task.task_id }}">
                                            <span class="checkbox-icon">
                                                <i class="bi bi-check"></i>
                                            </span>
                                        </label>
                                    </div>
                                </td>
                                <td class="task-info-cell">
                                    <div class="task-info-wrapper">
                                        <div class="task-name-section">
                                            <h6 class="task-title">{{ task.task_name or task.task_id[:8] + '...' }}</h6>
                                        </div>
                                        <div class="task-meta-section">
                                            <div class="task-meta-item">
                                                <i class="bi bi-fingerprint meta-icon"></i>
                                                <span class="meta-label">ID:</span>
                                                <code class="meta-value">{{ task.task_id[:8] }}...</code>
                                            </div>
                                            <div class="task-meta-item">
                                                <i class="bi bi-calendar-plus meta-icon"></i>
                                                <span class="meta-label">ÂàõÂª∫:</span>
                                                <span class="meta-value">{{ task.start_time | format_date }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="task-type-cell">
                                    <div class="type-info-wrapper">
                                        {% if task.task_type == 'scheduled' %}
                                            <div class="type-badge scheduled-badge">
                                                <i class="bi bi-clock-fill me-2"></i>
                                                <span class="badge-text">ÂÆöÊó∂‰ªªÂä°</span>
                                            </div>
                                            {% if task.interval_seconds %}
                                            <div class="type-detail">
                                                <i class="bi bi-arrow-repeat detail-icon"></i>
                                                <span class="detail-text">Èó¥Èöî: {{ task.interval_seconds | format_duration }}</span>
                                            </div>
                                            {% endif %}
                                        {% else %}
                                            <div class="type-badge immediate-badge">
                                                <i class="bi bi-play-fill me-2"></i>
                                                <span class="badge-text">‰∏ÄÊ¨°ÊÄß‰ªªÂä°</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </td>
                                <td class="task-status-cell">
                                    <div class="status-info-wrapper">
                                        <div class="status-badge status-{{ task.status }}">
                                            <span class="status-indicator"></span>
                                            <span class="status-text">{{ task.status | upper }}</span>
                                        </div>
                                        {% if task.task_type == 'scheduled' and task.is_running %}
                                        <div class="status-detail active">
                                            <span class="active-indicator"></span>
                                            <span class="detail-text">Ê¥ªË∑É‰∏≠</span>
                                        </div>
                                        {% endif %}
                                        {% if task.progress is defined and task.progress > 0 %}
                                        <div class="progress-wrapper">
                                            <div class="modern-progress">
                                                <div class="progress-bar" style="width: {{ (task.progress * 100) | round(1) }}%"></div>
                                            </div>
                                            <span class="progress-text">{{ (task.progress * 100) | round(1) }}%</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </td>
                                <td class="execution-info-cell">
                                    <div class="execution-info-wrapper">
                                        {% if task.task_type == 'scheduled' %}
                                            <!-- ÂÆöÊó∂‰ªªÂä°ÊâßË°å‰ø°ÊÅØ -->
                                            <div class="execution-main-info">
                                                <div class="execution-count-badge">
                                                    <i class="bi bi-arrow-repeat"></i>
                                                    <span>{{ task.execution_count or 0 }} Ê¨°</span>
                                                </div>
                                                {% if task.papers_found is defined and task.papers_found is not none and task.papers_found > 0 %}
                                                <div class="paper-count-badge">
                                                    <i class="bi bi-file-text"></i>
                                                    <span>{{ task.papers_found }} ÁØáËÆ∫Êñá</span>
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% if task.last_executed_at or task.next_execution_at %}
                                            <div class="execution-timeline">
                                                {% if task.last_executed_at %}
                                                <div class="timeline-item last">
                                                    <div class="timeline-dot"></div>
                                                    <div class="timeline-content">
                                                        <span class="timeline-label">‰∏äÊ¨°</span>
                                                        <span class="timeline-time">{{ task.last_executed_at | format_date }}</span>
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% if task.next_execution_at %}
                                                <div class="timeline-item next">
                                                    <div class="timeline-dot"></div>
                                                    <div class="timeline-content">
                                                        <span class="timeline-label">‰∏ãÊ¨°</span>
                                                        <span class="timeline-time">{{ task.next_execution_at | format_date }}</span>
                                                    </div>
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                        {% else %}
                                            <!-- ‰∏ÄÊ¨°ÊÄß‰ªªÂä°ÊâßË°å‰ø°ÊÅØ -->
                                            <div class="execution-main-info">
                                                {% if task.end_time %}
                                                <div class="completion-info">
                                                    <i class="bi bi-check-circle-fill text-success"></i>
                                                    <span class="completion-text">Â∑≤ÂÆåÊàê</span>
                                                </div>
                                                {% endif %}
                                                {% if task.papers_found is defined and task.papers_found is not none and task.papers_found > 0 %}
                                                <div class="paper-count-badge">
                                                    <i class="bi bi-file-text"></i>
                                                    <span>{{ task.papers_found }} ÁØáËÆ∫Êñá</span>
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% if task.end_time or task.duration %}
                                            <div class="execution-details">
                                                {% if task.end_time %}
                                                <div class="detail-line">
                                                    <span class="detail-time">{{ task.end_time | format_date }}</span>
                                                </div>
                                                {% endif %}
                                                {% if task.duration %}
                                                <div class="detail-line">
                                                    <i class="bi bi-stopwatch me-1"></i>
                                                    <span class="duration-text">{{ task.duration | format_duration }}</span>
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                        {% endif %}
                                        
                                        <!-- ËÆ∫ÊñáÁªìÊûúÂæΩÁ´† -->
                                        {% if task.papers_found is defined and task.papers_found is not none %}
                                        <div class="papers-result">
                                            <div class="papers-count-badge">
                                                <i class="bi bi-file-text"></i>
                                                <span>{{ task.papers_found }} ÁØá</span>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </td>
                                <td class="config-info-cell">
                                    <div class="config-info-wrapper">
                                        {% if task.search_query %}
                                        <div class="config-item search">
                                            <div class="config-badge search-badge" 
                                                 title="{{ task.search_query }}" data-bs-toggle="tooltip">
                                                <i class="bi bi-search config-icon"></i>
                                                <span class="config-text">{{ task.search_query }}</span>
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if task.llm_model_name %}
                                        <div class="config-item model">
                                            <div class="config-badge model-badge" 
                                                 title="{{ task.llm_model_name }}" data-bs-toggle="tooltip">
                                                <i class="bi bi-cpu config-icon"></i>
                                                <span class="config-text">{{ task.llm_model_name }}</span>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </td>
                                <td class="actions-cell">
                                    <div class="modern-actions">
                                        <!-- Êü•ÁúãËØ¶ÊÉÖ -->
                                        <button class="action-btn info-btn" 
                                                onclick="showTaskDetails('{{ task.task_id }}')" 
                                                title="Êü•ÁúãËØ¶ÊÉÖ" data-bs-toggle="tooltip">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        
                                        <!-- ÂÆöÊó∂‰ªªÂä°ÁâπÊÆäÊìç‰Ωú -->
                                        {% if task.task_type == 'scheduled' %}
                                            {% if task.status == 'running' and task.is_running %}
                                            <button class="action-btn success-btn" 
                                                    onclick="triggerScheduledTask('{{ task.task_id }}', '{{ task.task_name or task.task_id[:8] }}')" 
                                                    title="Á´ãÂç≥ÊâßË°å" data-bs-toggle="tooltip">
                                                <i class="bi bi-play-fill"></i>
                                            </button>
                                            <button class="action-btn warning-btn" 
                                                    onclick="pauseScheduledTask('{{ task.task_id }}', '{{ task.task_name or task.task_id[:8] }}')" 
                                                    title="ÊöÇÂÅú‰ªªÂä°" data-bs-toggle="tooltip">
                                                <i class="bi bi-pause-fill"></i>
                                            </button>
                                            {% elif task.status == 'paused' %}
                                            <button class="action-btn primary-btn" 
                                                    onclick="resumeScheduledTask('{{ task.task_id }}', '{{ task.task_name or task.task_id[:8] }}')" 
                                                    title="ÊÅ¢Â§ç‰ªªÂä°" data-bs-toggle="tooltip">
                                                <i class="bi bi-play-fill"></i>
                                            </button>
                                            {% endif %}
                                            <button class="action-btn edit-btn" 
                                                    onclick="editTaskConfig('{{ task.task_id }}')" 
                                                    title="ÁºñËæëÈÖçÁΩÆ" data-bs-toggle="tooltip">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                        {% endif %}
                                        
                                        <!-- ÂèñÊ∂àËøêË°å‰∏≠‰ªªÂä° -->
                                        {% if task.status in ['pending', 'running'] %}
                                        <button class="action-btn stop-btn" 
                                                onclick="cancelTask('{{ task.task_id }}')" 
                                                title="ÂèñÊ∂à‰ªªÂä°" data-bs-toggle="tooltip">
                                            <i class="bi bi-stop-fill"></i>
                                        </button>
                                        {% endif %}
                                        
                                        <!-- Âà†Èô§‰ªªÂä° -->
                                        <button class="action-btn danger-btn" 
                                                onclick="deleteTask('{{ task.task_id }}', '{{ task.task_name or task.task_id[:8] }}')" 
                                                title="Âà†Èô§‰ªªÂä°" data-bs-toggle="tooltip">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if pagination and pagination.total_pages > 1 %}
                <div class="d-flex justify-content-center mt-4">
                    <nav>
                        <ul class="pagination pagination-rounded">
                        {% if pagination.has_prev %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ pagination.prev_num }}">‰∏ä‰∏ÄÈ°µ</a>
                        </li>
                        {% endif %}
                        
                        {% for page_num in range(1, pagination.total_pages + 1) %}
                            {% if page_num == pagination.page %}
                            <li class="page-item active">
                                <span class="page-link">{{ page_num }}</span>
                            </li>
                            {% elif page_num <= 3 or page_num > pagination.total_pages - 3 or (page_num >= pagination.page - 1 and page_num <= pagination.page + 1) %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                            </li>
                            {% elif page_num == 4 and pagination.page > 6 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% elif page_num == pagination.total_pages - 3 and pagination.page < pagination.total_pages - 5 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if pagination.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ pagination.next_num }}">‰∏ã‰∏ÄÈ°µ</a>
                        </li>
                        {% endif %}
                        </ul>
                    </nav>
                </div>
                {% endif %}
                
                {% else %}
                <div class="empty-state" data-aos="fade-up" data-aos-delay="300">
                    <div class="empty-state-icon">
                        <i class="bi bi-list-task"></i>
                    </div>
                    <h5 class="empty-state-title">ÊöÇÊó†‰ªªÂä°Êï∞ÊçÆ</h5>
                    <p class="empty-state-text">ÂºÄÂßãÂàõÂª∫ÊÇ®ÁöÑÁ¨¨‰∏Ä‰∏™ËÆ∫ÊñáÊî∂ÈõÜ‰ªªÂä°ÔºåËá™Âä®ÂåñÊÇ®ÁöÑÁ†îÁ©∂ÊµÅÁ®ã</p>
                    <a href="{{ url_for('collect.config') }}" class="btn btn-gradient-primary btn-lg">
                        <i class="bi bi-plus-circle me-2"></i>Á´ãÂç≥ÂàõÂª∫‰ªªÂä°
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
</div>

<!-- Áé∞‰ª£Âåñ‰ªªÂä°ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
<div class="modal fade modern-modal" id="taskDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content modern-modal-content">
            <div class="modern-modal-header">
                <div class="modal-title-wrapper">
                    <div class="title-icon-container">
                        <i class="bi bi-info-circle title-icon"></i>
                        <div class="icon-glow-effect"></div>
                    </div>
                    <div class="title-text-container">
                        <h5 class="modal-title">‰ªªÂä°ËØ¶ÊÉÖ</h5>
                        <span class="modal-subtitle">Task Details</span>
                    </div>
                </div>
                <button type="button" class="modern-close-btn" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modern-modal-body">
                <div id="taskDetailsContent" class="task-details-wrapper">
                    <!-- ËØ¶ÊÉÖÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂ°´ÂÖÖ -->
                </div>
            </div>
            <div class="modern-modal-footer">
                <button type="button" class="btn modern-modal-btn secondary-btn" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-2"></i>
                    ÂÖ≥Èó≠
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Áé∞‰ª£Âåñ‰ªªÂä°ÈÖçÁΩÆÁºñËæëÊ®°ÊÄÅÊ°Ü -->
<div class="modal fade modern-modal" id="taskEditModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content modern-modal-content">
            <div class="modern-modal-header">
                <div class="modal-title-wrapper">
                    <div class="title-icon-container">
                        <i class="bi bi-pencil-square title-icon"></i>
                        <div class="icon-glow-effect"></div>
                    </div>
                    <div class="title-text-container">
                        <h5 class="modal-title">ÁºñËæëÂÆöÊó∂‰ªªÂä°ÈÖçÁΩÆ</h5>
                        <span class="modal-subtitle">Edit Scheduled Task Config</span>
                    </div>
                </div>
                <button type="button" class="modern-close-btn" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modern-modal-body">
                <div id="taskEditContent" class="task-edit-wrapper">
                    <!-- ÁºñËæëË°®ÂçïÂ∞ÜÈÄöËøáJavaScriptÂ°´ÂÖÖ -->
                </div>
            </div>
            <div class="modern-modal-footer">
                <button type="button" class="btn modern-modal-btn secondary-btn" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-2"></i>
                    ÂèñÊ∂à
                </button>
                <button type="button" class="btn modern-modal-btn primary-btn" onclick="saveTaskConfig()">
                    <i class="bi bi-check-circle me-2"></i>
                    ‰øùÂ≠òÈÖçÁΩÆ
                </button>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block scripts %}
<!-- AOS Animation Library -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<style>
/* ==============================================
   TasksÈ°µÈù¢Áé∞‰ª£ÂåñÊ†∑Âºè - ‰∏éindex.html‰øùÊåÅ‰∏ÄËá¥
============================================== */

/* Ê†πÂèòÈáèÂÆö‰πâ */
:root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    --info-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
    --glass-bg: rgba(255, 255, 255, 0.15);
    --glass-border: rgba(255, 255, 255, 0.2);
    --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.15);
    --shadow-medium: 0 12px 40px rgba(31, 38, 135, 0.25);
    --shadow-strong: 0 16px 48px rgba(31, 38, 135, 0.35);
}

/* È°µÈù¢Êï¥‰ΩìËÉåÊôØ */
body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
}

/* Hero Section - È°∂ÈÉ®Ê∏êÂèòÂå∫Âüü */
.hero-section {
    background: var(--primary-gradient);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    padding: 2rem 0 3rem;
    margin: -1.5rem -15px 2rem;
    position: relative;
    overflow: hidden;
}

.hero-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 20%, transparent 70%);
    animation: floatBubble 20s ease-in-out infinite;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes floatBubble {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    33% { transform: translateY(-20px) rotate(2deg); }
    66% { transform: translateY(10px) rotate(-1deg); }
}

/* Hero Title Styling */
.hero-title {
    font-size: 3.5rem;
    font-weight: 800;
    color: white;
    text-shadow: 2px 4px 20px rgba(0,0,0,0.3);
    margin-bottom: 1rem;
    position: relative;
    z-index: 2;
}

.hero-icon {
    background: rgba(255,255,255,0.2);
    padding: 0.5rem;
    border-radius: 50%;
    backdrop-filter: blur(10px);
    animation: iconPulse 3s ease-in-out infinite;
}

@keyframes iconPulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(255,255,255,0.3); }
    50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(255,255,255,0.5); }
}

.title-gradient {
    background: linear-gradient(45deg, #fff, #e0e8ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.title-subtitle {
    font-size: 0.7em;
    opacity: 0.9;
    margin-left: 1rem;
}

.hero-subtitle {
    font-size: 1.25rem;
    color: rgba(255,255,255,0.9);
    text-shadow: 1px 2px 10px rgba(0,0,0,0.2);
    position: relative;
    z-index: 2;
}

/* Modern Action Buttons */
.hero-action-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
    position: relative;
    z-index: 2;
}

.modern-action-btn {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(10px);
    color: white;
    padding: 0.875rem 1.5rem;
    border-radius: 15px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    font-weight: 600;
    box-shadow: var(--shadow-light);
}

.modern-action-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
    color: white;
}

.btn-icon-wrapper {
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-icon {
    font-size: 1rem;
}

.btn-content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.btn-title {
    font-size: 0.9rem;
    font-weight: 600;
    line-height: 1;
}

.btn-subtitle {
    font-size: 0.75rem;
    opacity: 0.8;
    line-height: 1;
}

/* Main Content */
.main-content {
    position: relative;
    z-index: 1;
}

/* Áé∞‰ª£ÂåñÁªüËÆ°Âç°Áâá */
.stats-section {
    margin-top: -2rem;
    position: relative;
    z-index: 2;
}

.modern-stats-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    height: 220px;
    min-height: 220px;
}

.modern-stats-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.1) 100%);
    pointer-events: none;
}

.modern-stats-card:hover {
    transform: translateY(-12px) scale(1.03);
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
}

/* ÂÆöÊó∂‰ªªÂä°Âç°Áâá - ËìùÁ¥´Ëâ≤Ê∏êÂèò */
.scheduled-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.scheduled-card:hover {
    box-shadow: 0 30px 60px rgba(102, 126, 234, 0.25);
}

/* ‰∏ÄÊ¨°ÊÄß‰ªªÂä°Âç°Áâá - ÈùíÁªøËâ≤Ê∏êÂèò */
.immediate-card {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
    color: white;
}

.immediate-card:hover {
    box-shadow: 0 30px 60px rgba(78, 205, 196, 0.25);
}

/* ËøêË°å‰∏≠‰ªªÂä°Âç°Áâá - Ê©ôÁ∫¢Ëâ≤Ê∏êÂèò */
.running-card {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    color: white;
}

.running-card:hover {
    box-shadow: 0 30px 60px rgba(250, 112, 154, 0.25);
}

/* ÊÄª‰ªªÂä°Êï∞Âç°Áâá - ÁªøËâ≤Ê∏êÂèò */
.total-card {
    background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
    color: white;
}

.total-card:hover {
    box-shadow: 0 30px 60px rgba(168, 230, 207, 0.25);
}

.stats-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 1.5rem 1rem;
    position: relative;
}

.stats-icon-container {
    position: relative;
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 16px;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.modern-stats-card:hover .stats-icon-container {
    transform: scale(1.1);
    background: rgba(255, 255, 255, 0.3);
}

.stats-icon {
    font-size: 1.75rem;
    color: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
}

.icon-glow {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
    border-radius: 16px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modern-stats-card:hover .icon-glow {
    opacity: 1;
    animation: glow-pulse 2s ease-in-out infinite;
}

@keyframes glow-pulse {
    0%, 100% { transform: scale(1); opacity: 0.3; }
    50% { transform: scale(1.1); opacity: 0.6; }
}

.spinning {
    animation: spin 3s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.stats-badge {
    background: rgba(255, 255, 255, 0.25);
    padding: 0.375rem 0.875rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.active-badge {
    background: rgba(255, 255, 255, 0.3);
    animation: badge-glow 2s ease-in-out infinite;
}

@keyframes badge-glow {
    0%, 100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
    50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.6); }
}

.pulse-dot {
    width: 8px;
    height: 8px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
    animation: pulse-dot 1.5s ease-in-out infinite;
}

@keyframes pulse-dot {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); opacity: 0.7; }
}

.stats-card-body {
    padding: 0.5rem 1.5rem 1.5rem;
    text-align: left;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.stats-number {
    font-size: 2.5rem;
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: 0.75rem;
    color: rgba(255, 255, 255, 0.95);
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.modern-stats-card:hover .stats-number {
    transform: scale(1.05);
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.stats-label {
    font-size: 1.1rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0.5rem;
    letter-spacing: 0.3px;
    line-height: 1.2;
}

.stats-description {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1.2;
}

.stats-card-footer {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    overflow: hidden;
}

.progress-ring {
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.2);
    position: relative;
}

.progress-fill {
    height: 100%;
    width: 0;
    background: rgba(255, 255, 255, 0.4);
    animation: progress-fill 3s ease-in-out infinite;
    border-radius: 0 2px 2px 0;
}

@keyframes progress-fill {
    0% { width: 0; }
    50% { width: 70%; }
    100% { width: 100%; }
}

.scheduled-progress {
    animation-delay: 0s;
}

.immediate-progress {
    animation-delay: 0.5s;
}

.running-progress {
    animation-delay: 1s;
    animation-duration: 2s;
}

.total-progress {
    animation-delay: 1.5s;
}

/* Áé∞‰ª£ÂåñÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
.modern-modal .modal-content {
    border: none;
    border-radius: 24px;
    box-shadow: 0 40px 80px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(20px);
    background: rgba(255, 255, 255, 0.98);
    overflow: hidden;
}

.modern-modal-content {
    position: relative;
}

.modern-modal-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-gradient);
    border-radius: 24px 24px 0 0;
}

.modern-modal-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    padding: 2rem 2.5rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title-wrapper {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.title-icon-container {
    position: relative;
    width: 60px;
    height: 60px;
    background: var(--primary-gradient);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.title-icon {
    font-size: 1.5rem;
    color: white;
}

.icon-glow-effect {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
    border-radius: 16px;
    animation: modal-glow 3s ease-in-out infinite;
}

@keyframes modal-glow {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
}

.title-text-container {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.modal-subtitle {
    font-size: 0.9rem;
    color: #64748b;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.modern-close-btn {
    width: 48px;
    height: 48px;
    background: rgba(239, 68, 68, 0.1);
    border: 2px solid rgba(239, 68, 68, 0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ef4444;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.modern-close-btn:hover {
    background: #ef4444;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
}

.modern-modal-body {
    padding: 2.5rem;
    max-height: 70vh;
    overflow-y: auto;
}

.modern-modal-body::-webkit-scrollbar {
    width: 8px;
}

.modern-modal-body::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

.modern-modal-body::-webkit-scrollbar-thumb {
    background: var(--primary-gradient);
    border-radius: 4px;
}

.modern-modal-body::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
}

.task-details-wrapper,
.task-edit-wrapper {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.modern-modal-footer {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    padding: 1.5rem 2.5rem;
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}

.modern-modal-btn {
    padding: 0.75rem 2rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.secondary-btn {
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    color: #475569;
    border-color: #cbd5e1;
}

.secondary-btn:hover {
    background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(71, 85, 105, 0.15);
    color: #334155;
}

.primary-btn {
    background: var(--primary-gradient);
    color: white;
    border-color: #667eea;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.primary-btn:hover {
    background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    color: white;
}

/* Ê®°ÊÄÅÊ°ÜÂä®ÁîªÂ¢ûÂº∫ */
.modern-modal.fade .modal-dialog {
    transform: scale(0.8) translateY(-50px);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modern-modal.show .modal-dialog {
    transform: scale(1) translateY(0);
    opacity: 1;
}

/* ‰ªªÂä°ËØ¶ÊÉÖÂç°ÁâáÊ†∑Âºè */
.task-details-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    padding: 0;
}

/* Âõõ‰∏™‰∏ªË¶ÅÈÖçÁΩÆÂç°Áâá */
.basic-info-card,
.search-config-card, 
.model-config-card,
.advanced-config-card {
    grid-column: span 1;
}

.detail-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    overflow: hidden;
}

.detail-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

.detail-card-header {
    padding: 1.5rem 1.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    position: relative;
}

.detail-card-header::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    height: 3px;
    border-radius: 16px 16px 0 0;
}

.basic-info-card .detail-card-header::before {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.search-config-card .detail-card-header::before {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
}

.model-config-card .detail-card-header::before {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}

.advanced-config-card .detail-card-header::before {
    background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
}

.user-requirements-card .detail-card-header::before {
    background: linear-gradient(135deg, #c3a6ff 0%, #9575cd 100%);
}

.error-card .detail-card-header::before {
    background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
}

.card-icon-wrapper {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: white;
    position: relative;
    overflow: hidden;
}

.basic-icon {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.search-icon {
    background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
}

.model-icon {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}

.advanced-icon {
    background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
}

.user-icon {
    background: linear-gradient(135deg, #c3a6ff 0%, #9575cd 100%);
}

.error-icon {
    background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
}

.card-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
    background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.detail-card-body {
    padding: 1.5rem;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.03);
    gap: 1rem;
}

.detail-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.detail-item:first-child {
    padding-top: 0;
}

.detail-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #64748b;
    flex-shrink: 0;
    min-width: 80px;
}

.detail-value {
    font-size: 0.9rem;
    font-weight: 500;
    color: #1e293b;
    text-align: right;
    word-break: break-word;
}

.detail-value code {
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    font-size: 0.8rem;
    color: #475569;
    border: 1px solid #cbd5e1;
}

.detail-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.detail-badge.scheduled {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.detail-badge.immediate {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.detail-badge.status-completed {
    background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
    color: white;
}

.detail-badge.status-running {
    background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
    color: white;
}

.detail-badge.status-failed {
    background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
    color: white;
}

.detail-badge.status-pending {
    background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
    color: white;
}

.detail-badge.status-stopped {
    background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);
    color: white;
}

.detail-badge.status-paused {
    background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
    color: white;
}

.detail-badge.papers {
    background: linear-gradient(135deg, #06b6d4 0%, #67e8f9 100%);
    color: white;
}

.detail-badge.mode {
    background: linear-gradient(135deg, #84cc16 0%, #a3e635 100%);
    color: white;
}

.detail-badge.enabled {
    background: linear-gradient(135deg, #22c55e 0%, #4ade80 100%);
    color: white;
}

.detail-badge.disabled {
    background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
    color: white;
}

.detail-badge.executions {
    background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
    color: white;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
    animation: pulse-status 2s ease-in-out infinite;
}

@keyframes pulse-status {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.1); }
}

.full-width {
    grid-column: 1 / -1;
}

.user-requirements-content {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid #c3a6ff;
    font-size: 0.9rem;
    line-height: 1.6;
    color: #475569;
}

.error-content {
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid #ff6b6b;
    font-size: 0.9rem;
    line-height: 1.6;
    color: #dc2626;
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
}

.duration {
    font-weight: 600;
    color: #059669;
}

.next-execution {
    font-weight: 600;
    color: #0ea5e9;
}

/* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
@media (max-width: 1200px) {
    .task-details-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .basic-info-card,
    .search-config-card {
        grid-column: span 1;
    }
    
    .model-config-card,
    .advanced-config-card {
        grid-column: span 1;
    }
}

@media (max-width: 768px) {
    .task-details-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .basic-info-card,
    .search-config-card, 
    .model-config-card,
    .advanced-config-card {
        grid-column: span 1;
    }
    
    .detail-card-header {
        padding: 1rem 1rem 0.75rem;
    }
    
    .detail-card-body {
        padding: 1rem;
    }
    
    .detail-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .detail-value {
        text-align: left;
    }
    
    .card-icon-wrapper {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
    }
    
    .card-title {
        font-size: 1rem;
    }
}

/* Áé∞‰ª£Âåñ‰ªªÂä°Âç°Áâá */
.modern-task-card {
    background: white;
    border-radius: 20px;
    box-shadow: var(--shadow-light);
    border: 1px solid rgba(255,255,255,0.3);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modern-task-card:hover {
    box-shadow: var(--shadow-medium);
    transform: translateY(-2px);
}

.task-card-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    padding: 1.5rem 2rem;
}

.task-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.task-icon {
    color: #667eea;
    font-size: 1.5rem;
}

.title-text {
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.title-badge {
    font-size: 0.8rem;
    opacity: 0.7;
    font-weight: 500;
}

/* Áé∞‰ª£ÂåñÁ≠õÈÄâÂô® */
.modern-filters {
    gap: 1.5rem;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.filter-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.modern-select {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 0.5rem 1rem;
    font-weight: 500;
    color: #1e293b;
    transition: all 0.3s ease;
    min-width: 140px;
}

.modern-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* ‰ªªÂä°Âç°Áâá‰∏ª‰Ωì */
.task-card-body {
    padding: 2rem;
}

/* Áé∞‰ª£ÂåñÊâπÈáèÊìç‰ΩúÂ∑•ÂÖ∑Ê†è */
.modern-batch-toolbar {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}

.modern-batch-toolbar::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: var(--primary-gradient);
    border-radius: 0 2px 2px 0;
}

.batch-toolbar-inner {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.batch-left {
    display: flex;
    align-items: center;
    gap: 2rem;
    flex-wrap: wrap;
}

.modern-checkbox {
    display: flex;
    align-items: center;
    position: relative;
}

.checkbox-input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    font-weight: 600;
    color: #1e293b;
    transition: all 0.3s ease;
}

.checkbox-icon {
    width: 20px;
    height: 20px;
    border: 2px solid #cbd5e1;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    background: white;
}

.checkbox-icon i {
    font-size: 0.75rem;
    color: white;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.checkbox-input:checked + .checkbox-label .checkbox-icon {
    background: var(--primary-gradient);
    border-color: #667eea;
    transform: scale(1.1);
}

.checkbox-input:checked + .checkbox-label .checkbox-icon i {
    opacity: 1;
}

.checkbox-text {
    font-size: 0.9rem;
}

.batch-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.modern-btn {
    background: white;
    border: 2px solid transparent;
    border-radius: 10px;
    padding: 0.75rem 1.25rem;
    font-weight: 600;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.danger-btn {
    border-color: #fecaca;
    color: #dc2626;
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
}

.danger-btn:hover {
    background: var(--danger-gradient);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
}

.warning-btn {
    border-color: #fed7aa;
    color: #d97706;
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
}

.warning-btn:hover {
    background: var(--warning-gradient);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
}

.task-count-badge {
    background: rgba(255,255,255,0.8);
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    padding: 0.75rem 1.25rem;
    font-weight: 600;
    color: #1e293b;
    display: flex;
    align-items: center;
    backdrop-filter: blur(10px);
}

.count-number {
    color: #667eea;
    font-weight: 700;
}

.filtered-text {
    opacity: 0.7;
    font-size: 0.85rem;
}

/* Áé∞‰ª£ÂåñË°®Ê†º */
.modern-table-container {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: var(--shadow-light);
    background: white;
}

.modern-table {
    width: 100%;
    margin: 0;
    border-collapse: separate;
    border-spacing: 0;
}

.modern-table thead {
    background: var(--primary-gradient);
}

.modern-table thead th {
    background: transparent;
    color: white;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.8rem;
    padding: 1.25rem 1rem;
    border: none;
    position: relative;
}

.table-header-main {
    text-align: left;
}

.table-header-secondary,
.table-header-actions {
    text-align: center;
}

.table-checkbox-col {
    text-align: center;
    width: 50px;
}

.modern-table-row {
    transition: all 0.3s ease;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    background: white;
}

.modern-table-row:hover {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, transparent 100%);
    transform: translateX(3px);
}

.modern-table-row td {
    padding: 1.25rem 1rem;
    border: none;
    vertical-align: middle;
}

/* Ë°®Ê†ºÂçïÂÖÉÊ†ºÊ†∑Âºè */
.table-checkbox-cell {
    text-align: center;
}

.task-info-cell {
    min-width: 250px;
}

.task-info-wrapper {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.task-name-section {
    margin-bottom: 0.5rem;
}

.task-title {
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0;
    line-height: 1.3;
}

.task-meta-section {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.task-meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
}

.meta-icon {
    color: #64748b;
    width: 12px;
}

.meta-label {
    color: #94a3b8;
    font-weight: 500;
}

.meta-value {
    color: #64748b;
    font-weight: 500;
}

.meta-value code {
    background: #f1f5f9;
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.75rem;
}

/* ‰ªªÂä°Á±ªÂûãÂçïÂÖÉÊ†º - ‰ºòÂåñÁâàÊú¨ */
.task-type-cell {
    text-align: center;
    padding: 1rem 0.75rem;
    min-width: 160px;
}

.type-info-wrapper {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    align-items: center;
    justify-content: center;
    min-height: 80px;
}

.type-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.25rem;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 700;
    white-space: nowrap;
    min-width: 130px;
    position: relative;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.type-badge::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 25px;
    padding: 1px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: subtract;
}

.type-badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.scheduled-badge {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
}

.scheduled-badge:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
}

.immediate-badge {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
}

.immediate-badge:hover {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
}

.badge-text {
    font-weight: 700;
    letter-spacing: 0.5px;
}

.type-badge i {
    font-size: 1rem;
    margin-right: 0.5rem;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
}

.type-detail {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.8rem;
    color: #64748b;
    font-weight: 600;
    background: rgba(148, 163, 184, 0.1);
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    border: 1px solid rgba(148, 163, 184, 0.2);
    backdrop-filter: blur(5px);
    transition: all 0.3s ease;
}

.type-detail:hover {
    background: rgba(148, 163, 184, 0.15);
    color: #475569;
}

.detail-icon {
    width: 10px;
}

/* ‰ªªÂä°Áä∂ÊÄÅÂçïÂÖÉÊ†º */
.task-status-cell {
    text-align: center;
}

.status-info-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.status-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
}

.status-pending {
    background: linear-gradient(135deg, #fef3c7, #fde047);
    color: #a16207;
}

.status-running {
    background: var(--primary-gradient);
    color: white;
}

.status-completed {
    background: var(--success-gradient);
    color: white;
}

.status-failed {
    background: var(--danger-gradient);
    color: white;
}

.status-stopped {
    background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
    color: #475569;
}

.status-paused {
    background: linear-gradient(135deg, #fed7aa, #fbbf24);
    color: #92400e;
}

.status-detail {
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.status-detail.active {
    color: #16a34a;
}

.active-indicator {
    width: 6px;
    height: 6px;
    background: #16a34a;
    border-radius: 50%;
    animation: pulse 1.5s ease-in-out infinite;
}

.progress-wrapper {
    width: 100px;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.modern-progress {
    height: 6px;
    background: #e2e8f0;
    border-radius: 3px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: var(--primary-gradient);
    border-radius: 3px;
    transition: width 0.3s ease;
}

.progress-text {
    font-size: 0.7rem;
    color: #64748b;
    text-align: center;
}

/* ÊâßË°å‰ø°ÊÅØÂçïÂÖÉÊ†º */
.execution-info-cell {
    text-align: center;
}

.execution-info-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.execution-badge {
    background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
    color: #475569;
    padding: 0.375rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.375rem;
}

.execution-count-badge {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
    transition: all 0.3s ease;
    margin-bottom: 0.5rem;
}

.execution-count-badge:hover {
    background: linear-gradient(135deg, #7c3aed, #6d28d9);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
}

.execution-count-badge i {
    font-size: 0.75rem;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
}

.paper-count-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    transition: all 0.3s ease;
}

.paper-count-badge:hover {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.paper-count-badge i {
    font-size: 0.75rem;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
}

.execution-detail {
    font-size: 0.7rem;
    color: #64748b;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    text-align: left;
}

.execution-detail.next {
    color: #0ea5e9;
}

.detail-label {
    font-weight: 500;
}

.detail-value {
    font-weight: 600;
}

.papers-badge {
    background: var(--info-gradient);
    color: white;
    padding: 0.375rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.375rem;
}

/* ÈÖçÁΩÆ‰ø°ÊÅØÂçïÂÖÉÊ†º */
.config-info-cell {
    text-align: center;
}

.config-info-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.config-item {
    width: 100%;
}

.config-badge {
    background: rgba(255,255,255,0.8);
    border: 1px solid #e2e8f0;
    color: #475569;
    padding: 0.375rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    max-width: 120px;
}

.search-badge {
    border-color: #bfdbfe;
}

.search-badge:hover {
    background: var(--primary-gradient);
    color: white;
    transform: scale(1.05);
}

.model-badge {
    border-color: #c7d2fe;
}

.model-badge:hover {
    background: var(--info-gradient);
    color: white;
    transform: scale(1.05);
}

.config-icon {
    width: 12px;
}

.config-text {
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
    max-width: 60px;
}

/* Êìç‰ΩúÂçïÂÖÉÊ†º */
.actions-cell {
    text-align: center;
}

.modern-actions {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.action-btn {
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.action-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: currentColor;
    opacity: 0.1;
    transition: opacity 0.3s ease;
}

.action-btn:hover::before {
    opacity: 0.2;
}

.action-btn:hover {
    transform: translateY(-2px) scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.info-btn {
    background: linear-gradient(135deg, #e0f2fe, #bae6fd);
    color: #0369a1;
}

.success-btn {
    background: linear-gradient(135deg, #dcfce7, #bbf7d0);
    color: #166534;
}

.warning-btn {
    background: linear-gradient(135deg, #fef3c7, #fde047);
    color: #a16207;
}

.primary-btn {
    background: linear-gradient(135deg, #ddd6fe, #c4b5fd);
    color: #5b21b6;
}

.edit-btn {
    background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
    color: #7c3aed;
}

.stop-btn {
    background: linear-gradient(135deg, #fed7aa, #fbbf24);
    color: #92400e;
}

.danger-btn {
    background: linear-gradient(135deg, #fecaca, #f87171);
    color: #dc2626;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-state-icon {
    font-size: 5rem;
    color: #cbd5e1;
    margin-bottom: 1.5rem;
    background: var(--info-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.empty-state-title {
    color: #64748b;
    margin-bottom: 1rem;
    font-weight: 600;
    font-size: 1.5rem;
}

.empty-state-text {
    color: #94a3b8;
    margin-bottom: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
    font-size: 1.1rem;
}

.btn-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    font-weight: 600;
    padding: 0.875rem 2rem;
    border-radius: 25px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-gradient-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    color: white;
}

/* Responsive Design */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2.5rem;
    }
    
    .hero-action-buttons {
        justify-content: center;
        margin-top: 1.5rem;
    }
    
    .modern-stats-card {
        height: 200px;
        min-height: 200px;
    }
    
    .stats-card-header {
        padding: 1rem 1rem 0.5rem;
    }
    
    .stats-card-body {
        padding: 0.5rem 1rem 1rem;
    }
    
    .stats-number {
        font-size: 2rem;
    }
    
    .stats-label {
        font-size: 1rem;
    }
    
    .stats-description {
        font-size: 0.8rem;
    }
    
    .batch-toolbar-inner {
        flex-direction: column;
        gap: 1.5rem;
    }
    
    .batch-left {
        flex-direction: column;
        gap: 1rem;
        width: 100%;
        align-items: flex-start;
    }
    
    .modern-actions {
        flex-wrap: wrap;
        gap: 0.375rem;
    }
    
    .action-btn {
        width: 32px;
        height: 32px;
    }
}

@media (max-width: 576px) {
    .hero-section {
        margin-left: -15px;
        margin-right: -15px;
    }
    
    .hero-title {
        font-size: 2rem;
    }
    
    .title-subtitle {
        display: block;
        margin-left: 0;
        margin-top: 0.5rem;
        font-size: 1rem;
    }
    
    .modern-stats-card {
        height: 180px;
        min-height: 180px;
    }
    
    .stats-card-header {
        padding: 0.75rem 1rem 0.25rem;
    }
    
    .stats-card-body {
        padding: 0.25rem 1rem 1rem;
    }
    
    .stats-number {
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }
    
    .stats-label {
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
    }
    
    .stats-description {
        font-size: 0.75rem;
    }
    
    .stats-icon-container {
        width: 48px;
        height: 48px;
    }
    
    .stats-icon {
        font-size: 1.5rem;
    }
    
    .stats-badge {
        padding: 0.25rem 0.5rem;
        font-size: 0.7rem;
    }
    
    .task-card-header {
        padding: 1rem;
    }
    
    .task-card-body {
        padding: 1rem;
    }
    
    .modern-batch-toolbar {
        padding: 1rem;
    }
}
</style>

<script>
// ÂàùÂßãÂåñAOSÂä®ÁîªÂíåÂÖ∂‰ªñÂäüËÉΩ
document.addEventListener('DOMContentLoaded', function() {
    // ÂàùÂßãÂåñAOSÂä®Áîª
    AOS.init({
        duration: 800,
        easing: 'ease-in-out-cubic',
        once: true,
        offset: 100,
        delay: 100
    });
});

$(document).ready(function() {
    // ÂàùÂßãÂåñÂ∑•ÂÖ∑ÊèêÁ§∫
    $('[data-bs-toggle="tooltip"]').tooltip();
    
    // ÂàùÂßãÂåñÁ≠õÈÄâÂô®‰∫ã‰ª∂
    $('#taskTypeFilter, #taskStatusFilter').change(function() {
        filterTasks();
    });
    
    // ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâÂäüËÉΩ
    $('#selectAll, #selectAllHeader').change(function() {
        const isChecked = $(this).prop('checked');
        $('.row-checkbox:visible').prop('checked', isChecked);
        $('#selectAll, #selectAllHeader').prop('checked', isChecked);
        updateBatchButtons();
    });
    
    // ÂçïË°åÂ§çÈÄâÊ°ÜÂèòÂåñ
    $('.row-checkbox').change(function() {
        const totalVisibleRows = $('.row-checkbox:visible').length;
        const checkedVisibleRows = $('.row-checkbox:visible:checked').length;
        
        $('#selectAll, #selectAllHeader').prop('checked', checkedVisibleRows === totalVisibleRows && totalVisibleRows > 0);
        updateBatchButtons();
    });
    
    // ÊâπÈáèÂà†Èô§ÊåâÈíÆÁÇπÂáª
    $('#batchDeleteBtn').click(function() {
        const selectedIds = $('.row-checkbox:checked').map(function() {
            return $(this).val();
        }).get();
        
        if (selectedIds.length === 0) {
            showAlert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑ‰ªªÂä°', 'warning');
            return;
        }
        
        batchDeleteTasks(selectedIds);
    });
    
    // ÊâπÈáèÂÅúÊ≠¢ÊåâÈíÆÁÇπÂáª
    $('#batchStopBtn').click(function() {
        const selectedIds = $('.row-checkbox:checked').map(function() {
            return $(this).val();
        }).get();
        
        if (selectedIds.length === 0) {
            showAlert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂÅúÊ≠¢ÁöÑ‰ªªÂä°', 'warning');
            return;
        }
        
        batchStopTasks(selectedIds);
    });
    
    // ÂÆöÊó∂Âà∑Êñ∞‰ªªÂä°Áä∂ÊÄÅÔºàÊØè30ÁßíÔºâ
    setInterval(refreshTaskStatus, 30000);
});

// Á≠õÈÄâ‰ªªÂä°
function filterTasks() {
    const typeFilter = $('#taskTypeFilter').val();
    const statusFilter = $('#taskStatusFilter').val();
    
    let visibleCount = 0;
    $('.task-row').each(function() {
        const taskType = $(this).data('task-type');
        const taskStatus = $(this).data('task-status');
        
        let showTask = true;
        
        // Á±ªÂûãÁ≠õÈÄâ
        if (typeFilter !== 'all' && taskType !== typeFilter) {
            showTask = false;
        }
        
        // Áä∂ÊÄÅÁ≠õÈÄâ
        if (statusFilter !== 'all' && taskStatus !== statusFilter) {
            showTask = false;
        }
        
        if (showTask) {
            $(this).removeClass('d-none');
            visibleCount++;
        } else {
            $(this).addClass('d-none');
        }
    });
    
    // Êõ¥Êñ∞ÊòæÁ§∫ÁªüËÆ°
    $('#totalTasksDisplay').text(visibleCount);
    if (typeFilter !== 'all' || statusFilter !== 'all') {
        $('#filteredTasksDisplay').removeClass('d-none');
    } else {
        $('#filteredTasksDisplay').addClass('d-none');
    }
    
    // ÈáçÁΩÆÈÄâÊã©Áä∂ÊÄÅ
    $('.row-checkbox').prop('checked', false);
    $('#selectAll, #selectAllHeader').prop('checked', false);
    updateBatchButtons();
}

// Êõ¥Êñ∞ÊâπÈáèÊìç‰ΩúÊåâÈíÆÁä∂ÊÄÅ
function updateBatchButtons() {
    const checkedCount = $('.row-checkbox:checked').length;
    const runnableTasksCount = $('.row-checkbox:checked').filter(function() {
        const row = $(this).closest('tr');
        const status = row.data('task-status');
        return ['pending', 'running'].includes(status);
    }).length;
    
    $('#selectedCount, #selectedStopCount').text(checkedCount);
    
    if (checkedCount > 0) {
        $('#batchDeleteBtn').removeClass('d-none');
        if (runnableTasksCount > 0) {
            $('#batchStopBtn').removeClass('d-none');
        } else {
            $('#batchStopBtn').addClass('d-none');
        }
    } else {
        $('#batchDeleteBtn, #batchStopBtn').addClass('d-none');
    }
}

// ÊòæÁ§∫‰ªªÂä°ËØ¶ÊÉÖ
function showTaskDetails(taskId) {
    // ‰ªéË°®Ê†ºË°å‰∏≠Ëé∑Âèñ‰ªªÂä°‰ø°ÊÅØÔºåÊàñÈÄöËøáAPIËé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ
    $.get(`/api/task/details/${taskId}`)
        .then(response => {
            if (response.success) {
                displayTaskDetails(response.data);
            } else {
                showAlert(`Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•: ${response.error}`, 'danger');
            }
        })
        .catch(error => {
            console.error('Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•:', error);
            showAlert('Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•', 'danger');
        });
}

// ÊòæÁ§∫‰ªªÂä°ËØ¶ÊÉÖÂÜÖÂÆπ
function displayTaskDetails(taskData) {
    // ‰ªéÁªìÊûúÊï∞ÊçÆ‰∏≠ÊèêÂèñÈÖçÁΩÆ‰ø°ÊÅØ
    const config = taskData.result_data?.config || {};
    
    // ÊêúÁ¥¢Ê®°ÂºèÊò†Â∞Ñ
    const searchModeMap = {
        'latest': 'ÊúÄÊñ∞ËÆ∫Êñá',
        'most_relevant': 'ÊúÄÁõ∏ÂÖ≥',
        'date_range': 'Êó•ÊúüËåÉÂõ¥',
        'after_year': 'ÊåáÂÆöÂπ¥‰ªΩÂêé'
    };

    // Ëé∑Âèñ‰ªªÂä°Áä∂ÊÄÅÂØπÂ∫îÁöÑÈ¢úËâ≤
    const getTaskStatusColor = (status) => {
        const statusColors = {
            'completed': 'success',
            'running': 'primary', 
            'failed': 'danger',
            'pending': 'warning',
            'stopped': 'secondary',
            'paused': 'info'
        };
        return statusColors[status] || 'secondary';
    };
    
    const detailsHtml = `
        <div class="task-details-grid">
            <!-- Âü∫Êú¨‰ø°ÊÅØÂç°Áâá -->
            <div class="detail-card basic-info-card">
                <div class="detail-card-header">
                    <div class="card-icon-wrapper basic-icon">
                        <i class="bi bi-info-circle"></i>
                    </div>
                    <h6 class="card-title">Âü∫Êú¨‰ø°ÊÅØ</h6>
                </div>
                <div class="detail-card-body">
                    <div class="detail-item">
                        <span class="detail-label">‰ªªÂä°ID</span>
                        <code class="detail-value task-id">${taskData.task_id}</code>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">‰ªªÂä°ÂêçÁß∞</span>
                        <span class="detail-value task-name">${config.task_name || taskData.task_name || 'Êú™ÂëΩÂêç‰ªªÂä°'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">‰ªªÂä°Á±ªÂûã</span>
                        <div class="detail-badge ${taskData.task_type === 'scheduled' ? 'scheduled' : 'immediate'}">
                            <i class="bi bi-${taskData.task_type === 'scheduled' ? 'clock' : 'lightning'} me-1"></i>
                            ${taskData.task_type === 'scheduled' ? 'ÂÆöÊó∂‰ªªÂä°' : '‰∏ÄÊ¨°ÊÄß‰ªªÂä°'}
                        </div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ÊâßË°åÁä∂ÊÄÅ</span>
                        <div class="detail-badge status-${taskData.status}">
                            <span class="status-dot"></span>
                            ${taskData.status.toUpperCase()}
                        </div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ÂàõÂª∫Êó∂Èó¥</span>
                        <span class="detail-value">${formatDate(taskData.start_time)}</span>
                    </div>
                    ${taskData.end_time ? `
                    <div class="detail-item">
                        <span class="detail-label">ÁªìÊùüÊó∂Èó¥</span>
                        <span class="detail-value">${formatDate(taskData.end_time)}</span>
                    </div>` : ''}
                    ${taskData.duration ? `
                    <div class="detail-item">
                        <span class="detail-label">ÊâßË°åÊó∂Èïø</span>
                        <span class="detail-value duration">${formatDuration(taskData.duration)}</span>
                    </div>` : ''}
                    ${taskData.papers_found !== undefined ? `
                    <div class="detail-item">
                        <span class="detail-label">ÊâæÂà∞ËÆ∫Êñá</span>
                        <div class="detail-badge papers">
                            <i class="bi bi-file-text me-1"></i>
                            ${taskData.papers_found} ÁØá
                        </div>
                    </div>` : ''}
                </div>
            </div>

            <!-- ÊêúÁ¥¢ÈÖçÁΩÆÂç°Áâá -->
            <div class="detail-card search-config-card">
                <div class="detail-card-header">
                    <div class="card-icon-wrapper search-icon">
                        <i class="bi bi-search"></i>
                    </div>
                    <h6 class="card-title">ÊêúÁ¥¢ÈÖçÁΩÆ</h6>
                </div>
                <div class="detail-card-body">
                    <div class="detail-item">
                        <span class="detail-label">ÊêúÁ¥¢ÂÖ≥ÈîÆËØç</span>
                        <code class="detail-value search-query">${config.search_query || taskData.search_query || 'Êú™ÈÖçÁΩÆ'}</code>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ÊêúÁ¥¢Ê®°Âºè</span>
                        <div class="detail-badge mode">
                            <i class="bi bi-funnel me-1"></i>
                            ${searchModeMap[config.search_mode] || config.search_mode || 'Êú™Áü•'}
                        </div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ÊúÄÂ§ßËÆ∫ÊñáÊï∞</span>
                        <span class="detail-value">${config.max_papers_per_search || '20'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Áõ∏ÂÖ≥ÊÄßÈòàÂÄº</span>
                        <span class="detail-value">${config.relevance_threshold || '0.7'}</span>
                    </div>
                    ${config.start_year ? `
                    <div class="detail-item">
                        <span class="detail-label">ÂºÄÂßãÂπ¥‰ªΩ</span>
                        <span class="detail-value">${config.start_year}</span>
                    </div>` : ''}
                    ${config.end_year ? `
                    <div class="detail-item">
                        <span class="detail-label">ÁªìÊùüÂπ¥‰ªΩ</span>
                        <span class="detail-value">${config.end_year}</span>
                    </div>` : ''}
                    ${config.after_year ? `
                    <div class="detail-item">
                        <span class="detail-label">ÊåáÂÆöÂπ¥‰ªΩÂêé</span>
                        <span class="detail-value">${config.after_year}</span>
                    </div>` : ''}
                </div>
            </div>

            <!-- Ê®°ÂûãÈÖçÁΩÆÂç°Áâá -->
            <div class="detail-card model-config-card">
                <div class="detail-card-header">
                    <div class="card-icon-wrapper model-icon">
                        <i class="bi bi-cpu"></i>
                    </div>
                    <h6 class="card-title">Ê®°ÂûãÈÖçÁΩÆ</h6>
                </div>
                <div class="detail-card-body">
                    <div class="detail-item">
                        <span class="detail-label">‰∏ªË¶ÅLLMÊ®°Âûã</span>
                        <code class="detail-value model-name">${config.llm_model_name || taskData.llm_model_name || 'ÈªòËÆ§Ê®°Âûã'}</code>
                    </div>
                    ${config.abstract_analysis_model ? `
                    <div class="detail-item">
                        <span class="detail-label">ÊëòË¶ÅÂàÜÊûêÊ®°Âûã</span>
                        <code class="detail-value">${config.abstract_analysis_model}</code>
                    </div>` : ''}
                    ${config.full_paper_analysis_model ? `
                    <div class="detail-item">
                        <span class="detail-label">ÂÖ®ÊñáÂàÜÊûêÊ®°Âûã</span>
                        <code class="detail-value">${config.full_paper_analysis_model}</code>
                    </div>` : ''}
                    ${config.deep_analysis_model ? `
                    <div class="detail-item">
                        <span class="detail-label">Ê∑±Â∫¶ÂàÜÊûêÊ®°Âûã</span>
                        <code class="detail-value">${config.deep_analysis_model}</code>
                    </div>` : ''}
                    ${config.vision_model ? `
                    <div class="detail-item">
                        <span class="detail-label">ËßÜËßâÊ®°Âûã</span>
                        <code class="detail-value">${config.vision_model}</code>
                    </div>` : ''}
                </div>
            </div>

            <!-- È´òÁ∫ßËÆæÁΩÆÂç°Áâá -->
            <div class="detail-card advanced-config-card">
                <div class="detail-card-header">
                    <div class="card-icon-wrapper advanced-icon">
                        <i class="bi bi-gear"></i>
                    </div>
                    <h6 class="card-title">È´òÁ∫ßËÆæÁΩÆ</h6>
                </div>
                <div class="detail-card-body">
                    <div class="detail-item">
                        <span class="detail-label">Ê∑±Â∫¶ÂàÜÊûê</span>
                        <div class="detail-badge ${config.enable_deep_analysis ? 'enabled' : 'disabled'}">
                            <i class="bi bi-${config.enable_deep_analysis ? 'check-circle' : 'x-circle'} me-1"></i>
                            ${config.enable_deep_analysis ? 'Â∑≤ÂêØÁî®' : 'Â∑≤Á¶ÅÁî®'}
                        </div>
                    </div>
                    ${config.deep_analysis_threshold ? `
                    <div class="detail-item">
                        <span class="detail-label">Ê∑±Â∫¶ÂàÜÊûêÈòàÂÄº</span>
                        <span class="detail-value">${config.deep_analysis_threshold}</span>
                    </div>` : ''}
                    ${config.ocr_char_limit_for_analysis ? `
                    <div class="detail-item">
                        <span class="detail-label">OCRÂ≠óÁ¨¶ÈôêÂà∂</span>
                        <span class="detail-value">${config.ocr_char_limit_for_analysis.toLocaleString()}</span>
                    </div>` : ''}
                    ${taskData.task_type === 'scheduled' ? `
                        <div class="detail-item">
                            <span class="detail-label">ÊâßË°åÈó¥Èöî</span>
                            <span class="detail-value">${formatDuration(config.interval_seconds)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ÊâßË°åÊ¨°Êï∞</span>
                            <div class="detail-badge executions">
                                <i class="bi bi-arrow-repeat me-1"></i>
                                ${taskData.execution_count || 0} Ê¨°
                            </div>
                        </div>
                        ${taskData.last_executed_at ? `
                        <div class="detail-item">
                            <span class="detail-label">‰∏äÊ¨°ÊâßË°å</span>
                            <span class="detail-value">${formatDate(taskData.last_executed_at)}</span>
                        </div>` : ''}
                        ${taskData.next_execution_at ? `
                        <div class="detail-item">
                            <span class="detail-label">‰∏ãÊ¨°ÊâßË°å</span>
                            <span class="detail-value next-execution">${formatDate(taskData.next_execution_at)}</span>
                        </div>` : ''}
                    ` : ''}
                </div>
            </div>

            ${config.user_requirements ? `
            <!-- Áî®Êà∑ÈúÄÊ±ÇÊèèËø∞Âç°Áâá -->
            <div class="detail-card user-requirements-card full-width">
                <div class="detail-card-header">
                    <div class="card-icon-wrapper user-icon">
                        <i class="bi bi-person-check"></i>
                    </div>
                    <h6 class="card-title">Áî®Êà∑ÈúÄÊ±ÇÊèèËø∞</h6>
                </div>
                <div class="detail-card-body">
                    <div class="user-requirements-content">
                        ${config.user_requirements}
                    </div>
                </div>
            </div>` : ''}

            ${taskData.error_message ? `
            <!-- ÈîôËØØ‰ø°ÊÅØÂç°Áâá -->
            <div class="detail-card error-card full-width">
                <div class="detail-card-header">
                    <div class="card-icon-wrapper error-icon">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <h6 class="card-title">ÈîôËØØ‰ø°ÊÅØ</h6>
                </div>
                <div class="detail-card-body">
                    <div class="error-content">
                        <i class="bi bi-bug me-2"></i>
                        ${taskData.error_message}
                    </div>
                </div>
            </div>` : ''}
        </div>
    `;
    
    document.getElementById('taskDetailsContent').innerHTML = detailsHtml;
    new bootstrap.Modal(document.getElementById('taskDetailsModal')).show();
}

// Âà∑Êñ∞‰ªªÂä°ÂàóË°®
function refreshTaskList() {
    location.reload();
}

// Âà∑Êñ∞‰ªªÂä°Áä∂ÊÄÅÔºàÈùôÈªòÊõ¥Êñ∞Ôºâ
function refreshTaskStatus() {
    $.get('/api/tasks/status')
        .then(response => {
            if (response.success) {
                updateTaskStatuses(response.data);
            }
        })
        .catch(error => {
            console.error('Âà∑Êñ∞‰ªªÂä°Áä∂ÊÄÅÂ§±Ë¥•:', error);
        });
}

// Êõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅÊòæÁ§∫
function updateTaskStatuses(statusData) {
    statusData.forEach(task => {
        const row = $(`.task-row[data-task-id="${task.task_id}"]`);
        if (row.length > 0) {
            // Êõ¥Êñ∞Áä∂ÊÄÅÂæΩÁ´†
            const statusBadge = row.find('.badge');
            statusBadge.removeClass().addClass(`badge bg-${getStatusBadgeClass(task.status)}`).text(task.status.toUpperCase());
            
            // Êõ¥Êñ∞ËøõÂ∫¶Êù°ÔºàÂ¶ÇÊûúÊúâÔºâ
            if (task.progress !== undefined) {
                const progressBar = row.find('.progress-bar');
                if (progressBar.length > 0) {
                    progressBar.css('width', `${(task.progress * 100).toFixed(1)}%`);
                }
            }
        }
    });
    
    // Êõ¥Êñ∞ÁªüËÆ°Êï∞Â≠ó
    updateTaskCounts();
}

// Êõ¥Êñ∞‰ªªÂä°ÁªüËÆ°Êï∞Â≠ó
function updateTaskCounts() {
    const totalTasks = $('.task-row').length;
    const scheduledTasks = $('.task-row[data-task-type="scheduled"]').length;
    const immediateTasks = $('.task-row[data-task-type="immediate"]').length;
    const runningTasks = $('.task-row[data-task-status="running"]').length;
    
    $('#totalTasksCount').text(totalTasks);
    $('#scheduledTasksCount').text(scheduledTasks);
    $('#immediateTasksCount').text(immediateTasks);
    $('#runningTasksCount').text(runningTasks);
}

// ÂèñÊ∂à‰ªªÂä°
function cancelTask(taskId) {
    if (!confirm('Á°ÆÂÆöË¶ÅÂèñÊ∂à‰ªªÂä° ' + taskId.substring(0, 8) + '... ÂêóÔºü')) {
        return;
    }
    
    performTaskAction(`/api/task/cancel/${taskId}`, 'POST', '‰ªªÂä°Â∑≤ÂèñÊ∂à', 'ÂèñÊ∂à‰ªªÂä°Â§±Ë¥•');
}

// Âà†Èô§‰ªªÂä°
function deleteTask(taskId, taskName) {
    const confirmMessage = `Á°ÆÂÆöË¶ÅÂà†Èô§‰ªªÂä°"${taskName}"ÂêóÔºü\n\nÊ≥®ÊÑèÔºöÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`;
    
    if (!confirm(confirmMessage)) {
        return;
    }
    
    performTaskAction(`/api/task/${taskId}`, 'DELETE', '‰ªªÂä°Âà†Èô§ÊàêÂäü', 'Âà†Èô§‰ªªÂä°Â§±Ë¥•');
}

// ÊâπÈáèÂà†Èô§‰ªªÂä°
function batchDeleteTasks(taskIds) {
    const confirmMessage = `Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${taskIds.length} ‰∏™‰ªªÂä°ÂêóÔºü\n\nÊ≥®ÊÑèÔºöÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`;
    
    if (!confirm(confirmMessage)) {
        return;
    }
    
    let completedCount = 0;
    let failedCount = 0;
    
    const promises = taskIds.map(taskId => {
        return fetch(`/api/task/${taskId}`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                completedCount++;
                $(`.task-row[data-task-id="${taskId}"]`).fadeOut();
            } else {
                failedCount++;
            }
        })
        .catch(() => failedCount++);
    });
    
    Promise.all(promises).finally(() => {
        if (failedCount === 0) {
            showAlert(`ÊàêÂäüÂà†Èô§ ${completedCount} ‰∏™‰ªªÂä°`, 'success');
        } else {
            showAlert(`Âà†Èô§ÂÆåÊàêÔºöÊàêÂäü ${completedCount} ‰∏™ÔºåÂ§±Ë¥• ${failedCount} ‰∏™`, 'warning');
        }
        setTimeout(() => location.reload(), 1500);
    });
}

// ÊâπÈáèÂÅúÊ≠¢‰ªªÂä°
function batchStopTasks(taskIds) {
    const confirmMessage = `Á°ÆÂÆöË¶ÅÂÅúÊ≠¢ÈÄâ‰∏≠ÁöÑ ${taskIds.length} ‰∏™‰ªªÂä°ÂêóÔºü`;
    
    if (!confirm(confirmMessage)) {
        return;
    }
    
    let completedCount = 0;
    let failedCount = 0;
    
    const promises = taskIds.map(taskId => {
        return fetch(`/api/task/cancel/${taskId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                completedCount++;
            } else {
                failedCount++;
            }
        })
        .catch(() => failedCount++);
    });
    
    Promise.all(promises).finally(() => {
        if (failedCount === 0) {
            showAlert(`ÊàêÂäüÂÅúÊ≠¢ ${completedCount} ‰∏™‰ªªÂä°`, 'success');
        } else {
            showAlert(`ÂÅúÊ≠¢ÂÆåÊàêÔºöÊàêÂäü ${completedCount} ‰∏™ÔºåÂ§±Ë¥• ${failedCount} ‰∏™`, 'warning');
        }
        setTimeout(() => location.reload(), 1500);
    });
}

// ÂÆöÊó∂‰ªªÂä°Êìç‰ΩúÂáΩÊï∞Ôºà‰ªéscheduled_tasks.htmlÁßªÊ§çÂπ∂ÁÆÄÂåñÔºâ
function triggerScheduledTask(taskId, taskName) {
    if (!confirm(`Á°ÆÂÆöË¶ÅÁ´ãÂç≥ÊâßË°åÂÆöÊó∂‰ªªÂä° "${taskName}" ÂêóÔºü`)) {
        return;
    }
    performTaskAction(`/api/scheduled_tasks/${taskId}/trigger`, 'POST', 'ÂÆöÊó∂‰ªªÂä°Â∑≤Ëß¶ÂèëÊâßË°å', 'Ëß¶Âèë‰ªªÂä°Â§±Ë¥•');
}

function pauseScheduledTask(taskId, taskName) {
    if (!confirm(`Á°ÆÂÆöË¶ÅÊöÇÂÅúÂÆöÊó∂‰ªªÂä° "${taskName}" ÂêóÔºü`)) {
        return;
    }
    performTaskAction(`/api/scheduled_tasks/${taskId}/pause`, 'POST', 'ÂÆöÊó∂‰ªªÂä°Â∑≤ÊöÇÂÅú', 'ÊöÇÂÅú‰ªªÂä°Â§±Ë¥•');
}

function resumeScheduledTask(taskId, taskName) {
    if (!confirm(`Á°ÆÂÆöË¶ÅÊÅ¢Â§çÂÆöÊó∂‰ªªÂä° "${taskName}" ÂêóÔºü`)) {
        return;
    }
    performTaskAction(`/api/scheduled_tasks/${taskId}/resume`, 'POST', 'ÂÆöÊó∂‰ªªÂä°Â∑≤ÊÅ¢Â§ç', 'ÊÅ¢Â§ç‰ªªÂä°Â§±Ë¥•');
}

function editTaskConfig(taskId) {
    // ËøôÈáåÂèØ‰ª•Âä†ËΩΩÁºñËæëË°®ÂçïÔºåÊöÇÊó∂ÁÆÄÂåñÂ§ÑÁêÜ
    showAlert('ÁºñËæëÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
}

// ÈÄöÁî®‰ªªÂä°Êìç‰ΩúÂáΩÊï∞
function performTaskAction(url, method, successMessage, errorMessage) {
    fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert(successMessage, 'success');
            setTimeout(() => location.reload(), 1500);
        } else {
            showAlert(`${errorMessage}: ${data.error}`, 'danger');
        }
    })
    .catch(error => {
        console.error('‰ªªÂä°Êìç‰ΩúÂ§±Ë¥•:', error);
        showAlert(`${errorMessage}ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•`, 'danger');
    });
}

// Â∑•ÂÖ∑ÂáΩÊï∞
function getStatusBadgeClass(status) {
    const statusMap = {
        'pending': 'warning',
        'running': 'primary',
        'completed': 'success',
        'failed': 'danger',
        'stopped': 'secondary',
        'paused': 'warning'
    };
    return statusMap[status] || 'secondary';
}

function formatDate(dateString) {
    if (!dateString) return 'Êú™Áü•';
    const date = new Date(dateString);
    return date.toLocaleString('zh-CN');
}

function formatDuration(seconds) {
    if (!seconds) return '0Áßí';
    
    if (seconds < 60) {
        return `${seconds}Áßí`;
    } else if (seconds < 3600) {
        return `${Math.round(seconds / 60)}ÂàÜÈíü`;
    } else if (seconds < 86400) {
        return `${Math.round(seconds / 3600)}Â∞èÊó∂`;
    } else {
        return `${Math.round(seconds / 86400)}Â§©`;
    }
}

function showAlert(message, type = 'info', duration = 5000) {
    const alertContainer = document.createElement('div');
    alertContainer.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    alertContainer.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
    
    alertContainer.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertContainer);
    
    if (duration > 0) {
        setTimeout(() => {
            if (alertContainer.parentNode) {
                alertContainer.parentNode.removeChild(alertContainer);
            }
        }, duration);
    }
    
    return alertContainer;
}

</script>
{% endblock %}